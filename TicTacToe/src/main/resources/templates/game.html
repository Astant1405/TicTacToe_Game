<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Tic Tac Toe Game</title>
    <meta http-equiv="refresh" content="5">
</head>
<body>
<h1>Tic Tac Toe Game</h1>

<a th:href="@{/game/home}">Back to Home</a>

<h2>Game ID: <span th:text="${gameId}"></span></h2>
<h3>Status: <span th:text="${game.status}"></span></h3>

<div th:if="${(game.status == 'В процессе' or game.status == 'в ожидании') and game.status == 'online'}">
    <p>Игрок 1 (X): <span th:text="${game.firstPerson.username}"></span></p>
    <p>Игрок 2 (O):
        <span th:if="${game.secondPerson != null}" th:text="${game.secondPerson.username}"></span>
        <span th:if="${game.secondPerson == null}">Ожидание игрока...</span>
    </p>

    <div th:if="${game.status == 'В процессе'}">
        <p>Сейчас ходит:
            <span th:if="${@ticTacService.determineCurrentTurn(game.board) == 1}">
                X (<span th:text="${game.firstPerson.username}"></span>)
            </span>
            <span th:if="${@ticTacService.determineCurrentTurn(game.board) == -1}">
                O (<span th:text="${game.secondPerson.username}"></span>)
            </span>
        </p>
    </div>
</div>

<table border="1">
    <tr th:each="i: ${#numbers.sequence(0, 2)}">
        <td th:each="j: ${#numbers.sequence(0, 2)}" style="width: 50px; height: 50px; text-align: center;">
            <span th:text="${game.getElement(i, j) == 1 ? 'X' : (game.getElement(i, j) == -1 ? 'O' : ' ')}"></span>
        </td>
    </tr>
</table>

<form th:action="@{'/game/' + ${gameId} + '/move'}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    <input type="number" name="row" min="0" max="2" placeholder="Row (0-2)" required>
    <input type="number" name="col" min="0" max="2" placeholder="Column (0-2)" required>
    <div th:if="${#fields.hasErrors('moveRequest.*')}" class="error-message" style="color: red;">
        <span th:each="error : ${#fields.errors('moveRequest.*')}" th:text="${error}"></span>
    </div>
    <button type="submit">Make Move</button>
</form>
</body>
</html>